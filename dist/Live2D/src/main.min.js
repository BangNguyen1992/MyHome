"use strict";function myApp(){this.platform=window.navigator.platform.toLowerCase(),this.live2DMgr=new LAppLive2DManager,this.isDrawStart=!1,this.gl=null,this.canvas=null,this.dragMgr=null,this.viewMatrix=null,this.projMatrix=null,this.deviceToScreen=null,this.drag=!1,this.oldLen=0,this.lastMouseX=0,this.lastMouseY=0,this.isModelShown=!1,initL2dCanvas("glcanvas"),init()}function initL2dCanvas(e){this.canvas=document.getElementById(e),this.canvas.addEventListener&&(this.canvas.addEventListener("mousewheel",mouseEvent,!1),this.canvas.addEventListener("click",mouseEvent,!1),this.canvas.addEventListener("mousedown",mouseEvent,!1),this.canvas.addEventListener("mousemove",mouseEvent,!1),this.canvas.addEventListener("mouseup",mouseEvent,!1),this.canvas.addEventListener("mouseout",mouseEvent,!1),this.canvas.addEventListener("contextmenu",mouseEvent,!1),this.canvas.addEventListener("touchstart",touchEvent,!1),this.canvas.addEventListener("touchend",touchEvent,!1),this.canvas.addEventListener("touchmove",touchEvent,!1)),btnChangeModel=document.getElementById("btnChange"),btnChangeModel.addEventListener("click",function(e){changeModel()})}function init(){var e=this.canvas.width,t=this.canvas.height;this.dragMgr=new L2DTargetPoint;var i=t/e,n=LAppDefine.VIEW_LOGICAL_LEFT,r=LAppDefine.VIEW_LOGICAL_RIGHT,a=-i,s=i;return this.viewMatrix=new L2DViewMatrix,this.viewMatrix.setScreenRect(n,r,a,s),this.viewMatrix.setMaxScreenRect(LAppDefine.VIEW_LOGICAL_MAX_LEFT,LAppDefine.VIEW_LOGICAL_MAX_RIGHT,LAppDefine.VIEW_LOGICAL_MAX_BOTTOM,LAppDefine.VIEW_LOGICAL_MAX_TOP),this.viewMatrix.setMaxScale(LAppDefine.VIEW_MAX_SCALE),this.viewMatrix.setMinScale(LAppDefine.VIEW_MIN_SCALE),this.projMatrix=new L2DMatrix44,this.projMatrix.multScale(1,e/t),this.deviceToScreen=new L2DMatrix44,this.deviceToScreen.multTranslate(-e/2,-t/2),this.deviceToScreen.multScale(2/e,-2/e),this.gl=getWebGLContext(),this.gl?(Live2D.setGL(this.gl),this.gl.clearColor(0,0,0,0),changeModel(),void startDraw()):void l2dError("Failed to create WebGL context.")}function startDraw(){this.isDrawStart||(this.isDrawStart=!0,function e(){draw();var t=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;t(e,this.canvas)}())}function draw(){MatrixStack.reset(),MatrixStack.loadIdentity(),this.dragMgr.update(),this.live2DMgr.setDrag(this.dragMgr.getX(),this.dragMgr.getY()),this.gl.clear(this.gl.COLOR_BUFFER_BIT),MatrixStack.multMatrix(projMatrix.getArray()),MatrixStack.multMatrix(viewMatrix.getArray()),MatrixStack.push();for(var e=0;e<this.live2DMgr.numModels();e++){var t=this.live2DMgr.getModel(e);if(null==t)return;if(t.initialized&&!t.updating&&(t.update(),t.draw(this.gl),!this.isModelShown&&e==this.live2DMgr.numModels()-1)){this.isModelShown=!this.isModelShown;var i=document.getElementById("btnChange");i.textContent="Change Model",i.removeAttribute("disabled"),i.setAttribute("class","active")}}MatrixStack.pop()}function changeModel(){var e=document.getElementById("btnChange");e.setAttribute("disabled","disabled"),e.setAttribute("class","inactive"),e.textContent="Now Loading...",this.isModelShown=!1,this.live2DMgr.reloadFlg=!0,this.live2DMgr.count++,this.live2DMgr.changeModel(this.gl)}function modelScaling(e){var t=thisRef.viewMatrix.isMaxScale(),i=thisRef.viewMatrix.isMinScale();thisRef.viewMatrix.adjustScale(0,0,e),t||thisRef.viewMatrix.isMaxScale()&&thisRef.live2DMgr.maxScaleEvent(),i||thisRef.viewMatrix.isMinScale()&&thisRef.live2DMgr.minScaleEvent()}function modelTurnHead(e){thisRef.drag=!0;var t=e.target.getBoundingClientRect(),i=transformScreenX(e.clientX-t.left),n=transformScreenY(e.clientY-t.top),r=transformViewX(e.clientX-t.left),a=transformViewY(e.clientY-t.top);LAppDefine.DEBUG_MOUSE_LOG&&l2dLog("onMouseDown device( x:"+e.clientX+" y:"+e.clientY+" ) view( x:"+r+" y:"+a+")"),thisRef.lastMouseX=i,thisRef.lastMouseY=n,thisRef.dragMgr.setPoint(r,a),thisRef.live2DMgr.tapEvent(r,a)}function followPointer(e){var t=e.target.getBoundingClientRect(),i=transformScreenX(e.clientX-t.left),n=transformScreenY(e.clientY-t.top),r=transformViewX(e.clientX-t.left),a=transformViewY(e.clientY-t.top);LAppDefine.DEBUG_MOUSE_LOG&&l2dLog("onMouseMove device( x:"+e.clientX+" y:"+e.clientY+" ) view( x:"+r+" y:"+a+")"),thisRef.drag&&(thisRef.lastMouseX=i,thisRef.lastMouseY=n,thisRef.dragMgr.setPoint(r,a))}function lookFront(){thisRef.drag&&(thisRef.drag=!1),thisRef.dragMgr.setPoint(0,0)}function mouseEvent(e){if(e.preventDefault(),"mousewheel"==e.type){if(e.clientX<0||thisRef.canvas.clientWidth<e.clientX||e.clientY<0||thisRef.canvas.clientHeight<e.clientY)return;modelScaling(e.wheelDelta>0?1.1:.9)}else if("mousedown"==e.type){if("button"in e&&0!=e.button)return;modelTurnHead(e)}else if("mousemove"==e.type)followPointer(e);else if("mouseup"==e.type){if("button"in e&&0!=e.button)return;lookFront()}else"mouseout"==e.type?lookFront():"contextmenu"==e.type&&changeModel()}function touchEvent(e){e.preventDefault();var t=e.touches[0];if("touchstart"==e.type)1==e.touches.length&&modelTurnHead(t);else if("touchmove"==e.type){if(followPointer(t),2==e.touches.length){var i=e.touches[0],n=e.touches[1],r=Math.pow(i.pageX-n.pageX,2)+Math.pow(i.pageY-n.pageY,2);modelScaling(thisRef.oldLen-r<0?1.025:.975),thisRef.oldLen=r}}else"touchend"==e.type&&lookFront()}function transformViewX(e){var t=this.deviceToScreen.transformX(e);return viewMatrix.invertTransformX(t)}function transformViewY(e){var t=this.deviceToScreen.transformY(e);return viewMatrix.invertTransformY(t)}function transformScreenX(e){return this.deviceToScreen.transformX(e)}function transformScreenY(e){return this.deviceToScreen.transformY(e)}function getWebGLContext(){for(var e=["webgl","experimental-webgl","webkit-3d","moz-webgl"],t=0;t<e.length;t++)try{var i=this.canvas.getContext(e[t],{premultipliedAlpha:!0});if(i)return i}catch(n){}return null}function l2dLog(e){if(LAppDefine.DEBUG_LOG){var t=document.getElementById("myconsole");t.innerHTML=t.innerHTML+"<br>"+e,console.log(e)}}function l2dError(e){LAppDefine.DEBUG_LOG&&(l2dLog("<span style='color:red'>"+e+"</span>"),console.error(e))}var thisRef=void 0;window.onerror=function(e,t,i,n,r){var a="file:"+t+"<br>line:"+i+" "+e;l2dError(a)};
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkxpdmUyRC9zcmMvbWFpbi5qcyJdLCJuYW1lcyI6WyJteUFwcCIsInRoaXMiLCJwbGF0Zm9ybSIsIndpbmRvdyIsIm5hdmlnYXRvciIsInRvTG93ZXJDYXNlIiwibGl2ZTJETWdyIiwiTEFwcExpdmUyRE1hbmFnZXIiLCJpc0RyYXdTdGFydCIsImdsIiwiY2FudmFzIiwiZHJhZ01nciIsInZpZXdNYXRyaXgiLCJwcm9qTWF0cml4IiwiZGV2aWNlVG9TY3JlZW4iLCJkcmFnIiwib2xkTGVuIiwibGFzdE1vdXNlWCIsImxhc3RNb3VzZVkiLCJpc01vZGVsU2hvd24iLCJpbml0TDJkQ2FudmFzIiwiaW5pdCIsImNhbnZhc0lkIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsImFkZEV2ZW50TGlzdGVuZXIiLCJtb3VzZUV2ZW50IiwidG91Y2hFdmVudCIsImJ0bkNoYW5nZU1vZGVsIiwiZSIsImNoYW5nZU1vZGVsIiwid2lkdGgiLCJoZWlnaHQiLCJMMkRUYXJnZXRQb2ludCIsInJhdGlvIiwibGVmdCIsIkxBcHBEZWZpbmUiLCJWSUVXX0xPR0lDQUxfTEVGVCIsInJpZ2h0IiwiVklFV19MT0dJQ0FMX1JJR0hUIiwiYm90dG9tIiwidG9wIiwiTDJEVmlld01hdHJpeCIsInNldFNjcmVlblJlY3QiLCJzZXRNYXhTY3JlZW5SZWN0IiwiVklFV19MT0dJQ0FMX01BWF9MRUZUIiwiVklFV19MT0dJQ0FMX01BWF9SSUdIVCIsIlZJRVdfTE9HSUNBTF9NQVhfQk9UVE9NIiwiVklFV19MT0dJQ0FMX01BWF9UT1AiLCJzZXRNYXhTY2FsZSIsIlZJRVdfTUFYX1NDQUxFIiwic2V0TWluU2NhbGUiLCJWSUVXX01JTl9TQ0FMRSIsIkwyRE1hdHJpeDQ0IiwibXVsdFNjYWxlIiwibXVsdFRyYW5zbGF0ZSIsImdldFdlYkdMQ29udGV4dCIsIkxpdmUyRCIsInNldEdMIiwiY2xlYXJDb2xvciIsInN0YXJ0RHJhdyIsImwyZEVycm9yIiwidGljayIsImRyYXciLCJyZXF1ZXN0QW5pbWF0aW9uRnJhbWUiLCJtb3pSZXF1ZXN0QW5pbWF0aW9uRnJhbWUiLCJ3ZWJraXRSZXF1ZXN0QW5pbWF0aW9uRnJhbWUiLCJtc1JlcXVlc3RBbmltYXRpb25GcmFtZSIsIk1hdHJpeFN0YWNrIiwicmVzZXQiLCJsb2FkSWRlbnRpdHkiLCJ1cGRhdGUiLCJzZXREcmFnIiwiZ2V0WCIsImdldFkiLCJjbGVhciIsIkNPTE9SX0JVRkZFUl9CSVQiLCJtdWx0TWF0cml4IiwiZ2V0QXJyYXkiLCJwdXNoIiwiaSIsIm51bU1vZGVscyIsIm1vZGVsIiwiZ2V0TW9kZWwiLCJpbml0aWFsaXplZCIsInVwZGF0aW5nIiwiYnRuQ2hhbmdlIiwidGV4dENvbnRlbnQiLCJyZW1vdmVBdHRyaWJ1dGUiLCJzZXRBdHRyaWJ1dGUiLCJwb3AiLCJyZWxvYWRGbGciLCJjb3VudCIsIm1vZGVsU2NhbGluZyIsInNjYWxlIiwiaXNNYXhTY2FsZSIsInRoaXNSZWYiLCJpc01pblNjYWxlIiwiYWRqdXN0U2NhbGUiLCJtYXhTY2FsZUV2ZW50IiwibWluU2NhbGVFdmVudCIsIm1vZGVsVHVybkhlYWQiLCJldmVudCIsInJlY3QiLCJ0YXJnZXQiLCJnZXRCb3VuZGluZ0NsaWVudFJlY3QiLCJzeCIsInRyYW5zZm9ybVNjcmVlblgiLCJjbGllbnRYIiwic3kiLCJ0cmFuc2Zvcm1TY3JlZW5ZIiwiY2xpZW50WSIsInZ4IiwidHJhbnNmb3JtVmlld1giLCJ2eSIsInRyYW5zZm9ybVZpZXdZIiwiREVCVUdfTU9VU0VfTE9HIiwibDJkTG9nIiwic2V0UG9pbnQiLCJ0YXBFdmVudCIsImZvbGxvd1BvaW50ZXIiLCJsb29rRnJvbnQiLCJwcmV2ZW50RGVmYXVsdCIsInR5cGUiLCJjbGllbnRXaWR0aCIsImNsaWVudEhlaWdodCIsIndoZWVsRGVsdGEiLCJidXR0b24iLCJ0b3VjaCIsInRvdWNoZXMiLCJsZW5ndGgiLCJ0b3VjaDEiLCJ0b3VjaDIiLCJsZW4iLCJNYXRoIiwicG93IiwicGFnZVgiLCJwYWdlWSIsImRldmljZVgiLCJzY3JlZW5YIiwidHJhbnNmb3JtWCIsImludmVydFRyYW5zZm9ybVgiLCJkZXZpY2VZIiwic2NyZWVuWSIsInRyYW5zZm9ybVkiLCJpbnZlcnRUcmFuc2Zvcm1ZIiwiTkFNRVMiLCJjdHgiLCJnZXRDb250ZXh0IiwicHJlbXVsdGlwbGllZEFscGhhIiwibXNnIiwiREVCVUdfTE9HIiwibXljb25zb2xlIiwiaW5uZXJIVE1MIiwiY29uc29sZSIsImxvZyIsImVycm9yIiwib25lcnJvciIsInVybCIsImxpbmUiLCJjb2wiLCJlcnJtc2ciXSwibWFwcGluZ3MiOiJBQUFBLFlBUUEsU0FBU0EsU0FFTEMsS0FBS0MsU0FBV0MsT0FBT0MsVUFBVUYsU0FBU0csY0FFMUNKLEtBQUtLLFVBQVksR0FBSUMsbUJBRXJCTixLQUFLTyxhQUFjLEVBRW5CUCxLQUFLUSxHQUFLLEtBQ1ZSLEtBQUtTLE9BQVMsS0FFZFQsS0FBS1UsUUFBVSxLQUNmVixLQUFLVyxXQUFhLEtBQ2xCWCxLQUFLWSxXQUFhLEtBQ2xCWixLQUFLYSxlQUFpQixLQUV0QmIsS0FBS2MsTUFBTyxFQUNaZCxLQUFLZSxPQUFTLEVBRWRmLEtBQUtnQixXQUFhLEVBQ2xCaEIsS0FBS2lCLFdBQWEsRUFFbEJqQixLQUFLa0IsY0FBZSxFQUdwQkMsY0FBYyxZQUdkQyxPQUlKLFFBQVNELGVBQWNFLEdBR25CckIsS0FBS1MsT0FBU2EsU0FBU0MsZUFBZUYsR0FHbkNyQixLQUFLUyxPQUFPZSxtQkFDWHhCLEtBQUtTLE9BQU9lLGlCQUFpQixhQUFjQyxZQUFZLEdBQ3ZEekIsS0FBS1MsT0FBT2UsaUJBQWlCLFFBQVNDLFlBQVksR0FFbER6QixLQUFLUyxPQUFPZSxpQkFBaUIsWUFBYUMsWUFBWSxHQUN0RHpCLEtBQUtTLE9BQU9lLGlCQUFpQixZQUFhQyxZQUFZLEdBRXREekIsS0FBS1MsT0FBT2UsaUJBQWlCLFVBQVdDLFlBQVksR0FDcER6QixLQUFLUyxPQUFPZSxpQkFBaUIsV0FBWUMsWUFBWSxHQUNyRHpCLEtBQUtTLE9BQU9lLGlCQUFpQixjQUFlQyxZQUFZ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QVN5RixHQUVWbEgsV0FBV21ILFlBRWZsQyxPQUFRLDJCQUE2QmlDLEVBQU0sV0FFM0NJLFFBQVFFLE1BQU1OLElBNWJsQixHQUFJdEQsU0FBQUEsTUFHSjdGLFFBQU8wSixRQUFVLFNBQVNQLEVBQUtRLEVBQUtDLEVBQU1DLEVBQUtKLEdBQzNDLEdBQUlLLEdBQVMsUUFBVUgsRUFBTSxZQUFjQyxFQUFPLElBQU1ULENBQ3hEekYsVUFBU29HIiwiZmlsZSI6IkxpdmUyRC9zcmMvbWFpbi5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgdGhpc1JlZiA9IHRoaXM7XHJcblxyXG4vLyBKYXZhU2NyaXB044Gn55m655Sf44GX44Gf44Ko44Op44O844KS5Y+W5b6XXHJcbndpbmRvdy5vbmVycm9yID0gZnVuY3Rpb24obXNnLCB1cmwsIGxpbmUsIGNvbCwgZXJyb3IpIHtcclxuICAgIHZhciBlcnJtc2cgPSBcImZpbGU6XCIgKyB1cmwgKyBcIjxicj5saW5lOlwiICsgbGluZSArIFwiIFwiICsgbXNnO1xyXG4gICAgbDJkRXJyb3IoZXJybXNnKTtcclxufVxyXG5cclxuZnVuY3Rpb24gbXlBcHAoKVxyXG57XHJcbiAgICB0aGlzLnBsYXRmb3JtID0gd2luZG93Lm5hdmlnYXRvci5wbGF0Zm9ybS50b0xvd2VyQ2FzZSgpO1xyXG4gICAgXHJcbiAgICB0aGlzLmxpdmUyRE1nciA9IG5ldyBMQXBwTGl2ZTJETWFuYWdlcigpO1xyXG5cclxuICAgIHRoaXMuaXNEcmF3U3RhcnQgPSBmYWxzZTtcclxuICAgIFxyXG4gICAgdGhpcy5nbCA9IG51bGw7XHJcbiAgICB0aGlzLmNhbnZhcyA9IG51bGw7XHJcbiAgICBcclxuICAgIHRoaXMuZHJhZ01nciA9IG51bGw7IC8qbmV3IEwyRFRhcmdldFBvaW50KCk7Ki8gLy8g44OJ44Op44OD44Kw44Gr44KI44KL44Ki44OL44Oh44O844K344On44Oz44Gu566h55CGXHJcbiAgICB0aGlzLnZpZXdNYXRyaXggPSBudWxsOyAvKm5ldyBMMkRWaWV3TWF0cml4KCk7Ki9cclxuICAgIHRoaXMucHJvak1hdHJpeCA9IG51bGw7IC8qbmV3IEwyRE1hdHJpeDQ0KCkqL1xyXG4gICAgdGhpcy5kZXZpY2VUb1NjcmVlbiA9IG51bGw7IC8qbmV3IEwyRE1hdHJpeDQ0KCk7Ki9cclxuICAgIFxyXG4gICAgdGhpcy5kcmFnID0gZmFsc2U7IC8vIOODieODqeODg+OCsOS4reOBi+OBqeOBhuOBi1xyXG4gICAgdGhpcy5vbGRMZW4gPSAwOyAgICAvLyDkuozmnKzmjIfjgr/jg4Pjg5fjgZfjgZ/mmYLjga7kuozngrnplpPjga7ot53pm6JcclxuICAgIFxyXG4gICAgdGhpcy5sYXN0TW91c2VYID0gMDtcclxuICAgIHRoaXMubGFzdE1vdXNlWSA9IDA7XHJcbiAgICBcclxuICAgIHRoaXMuaXNNb2RlbFNob3duID0gZmFsc2U7XHJcbiAgICBcclxuICAgIC8vIOODouODh+ODq+aPj+eUu+eUqGNhbnZhc+OBruWIneacn+WMllxyXG4gICAgaW5pdEwyZENhbnZhcyhcImdsY2FudmFzXCIpO1xyXG4gICAgXHJcbiAgICAvLyDjg6Ljg4fjg6vnlKjjg57jg4jjg6rjgq/jgrnjga7liJ3mnJ/ljJbjgajmj4/nlLvjga7plovlp4tcclxuICAgIGluaXQoKTtcclxufVxyXG5cclxuXHJcbmZ1bmN0aW9uIGluaXRMMmRDYW52YXMoY2FudmFzSWQpXHJcbntcclxuICAgIC8vIGNhbnZhc+OCquODluOCuOOCp+OCr+ODiOOCkuWPluW+l1xyXG4gICAgdGhpcy5jYW52YXMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChjYW52YXNJZCk7XHJcbiAgICBcclxuICAgIC8vIOOCpOODmeODs+ODiOOBrueZu+mMslxyXG4gICAgaWYodGhpcy5jYW52YXMuYWRkRXZlbnRMaXN0ZW5lcikge1xyXG4gICAgICAgIHRoaXMuY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZXdoZWVsXCIsIG1vdXNlRXZlbnQsIGZhbHNlKTtcclxuICAgICAgICB0aGlzLmNhbnZhcy5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgbW91c2VFdmVudCwgZmFsc2UpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIHRoaXMuY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWRvd25cIiwgbW91c2VFdmVudCwgZmFsc2UpO1xyXG4gICAgICAgIHRoaXMuY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZW1vdmVcIiwgbW91c2VFdmVudCwgZmFsc2UpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIHRoaXMuY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZXVwXCIsIG1vdXNlRXZlbnQsIGZhbHNlKTtcclxuICAgICAgICB0aGlzLmNhbnZhcy5hZGRFdmVudExpc3RlbmVyKFwibW91c2VvdXRcIiwgbW91c2VFdmVudCwgZmFsc2UpO1xyXG4gICAgICAgIHRoaXMuY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoXCJjb250ZXh0bWVudVwiLCBtb3VzZUV2ZW50LCBmYWxzZSk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8g44K/44OD44OB44Kk44OZ44Oz44OI44Gr5a++5b+cXHJcbiAgICAgICAgdGhpcy5jYW52YXMuYWRkRXZlbnRMaXN0ZW5lcihcInRvdWNoc3RhcnRcIiwgdG91Y2hFdmVudCwgZmFsc2UpO1xyXG4gICAgICAgIHRoaXMuY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoXCJ0b3VjaGVuZFwiLCB0b3VjaEV2ZW50LCBmYWxzZSk7XHJcbiAgICAgICAgdGhpcy5jYW52YXMuYWRkRXZlbnRMaXN0ZW5lcihcInRvdWNobW92ZVwiLCB0b3VjaEV2ZW50LCBmYWxzZSk7XHJcbiAgICAgICAgXHJcbiAgICB9XHJcbiAgICBcclxuICAgIGJ0bkNoYW5nZU1vZGVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJidG5DaGFuZ2VcIik7XHJcbiAgICBidG5DaGFuZ2VNb2RlbC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24oZSkge1xyXG4gICAgICAgIGNoYW5nZU1vZGVsKCk7XHJcbiAgICB9KTtcclxufVxyXG5cclxuXHJcbmZ1bmN0aW9uIGluaXQoKVxyXG57ICAgIFxyXG4gICAgLy8gM0Tjg5Djg4Pjg5XjgqHjga7liJ3mnJ/ljJZcclxuICAgIHZhciB3aWR0aCA9IHRoaXMuY2FudmFzLndpZHRoO1xyXG4gICAgdmFyIGhlaWdodCA9IHRoaXMuY2FudmFzLmhlaWdodDtcclxuICAgIFxyXG4gICAgdGhpcy5kcmFnTWdyID0gbmV3IEwyRFRhcmdldFBvaW50KCk7XHJcblxyXG4gICAgLy8g44OT44Ol44O86KGM5YiXXHJcbiAgICB2YXIgcmF0aW8gPSBoZWlnaHQgLyB3aWR0aDtcclxuICAgIHZhciBsZWZ0ID0gTEFwcERlZmluZS5WSUVXX0xPR0lDQUxfTEVGVDtcclxuICAgIHZhciByaWdodCA9IExBcHBEZWZpbmUuVklFV19MT0dJQ0FMX1JJR0hUO1xyXG4gICAgdmFyIGJvdHRvbSA9IC1yYXRpbztcclxuICAgIHZhciB0b3AgPSByYXRpbztcclxuXHJcbiAgICB0aGlzLnZpZXdNYXRyaXggPSBuZXcgTDJEVmlld01hdHJpeCgpO1xyXG5cclxuICAgIC8vIOODh+ODkOOCpOOCueOBq+WvvuW/nOOBmeOCi+eUu+mdouOBruevhOWbsuOAgiBY44Gu5bem56uvLCBY44Gu5Y+z56uvLCBZ44Gu5LiL56uvLCBZ44Gu5LiK56uvXHJcbiAgICB0aGlzLnZpZXdNYXRyaXguc2V0U2NyZWVuUmVjdChsZWZ0LCByaWdodCwgYm90dG9tLCB0b3ApO1xyXG4gICAgXHJcbiAgICAvLyDjg4fjg5DjgqTjgrnjgavlr77lv5zjgZnjgovnlLvpnaLjga7nr4Tlm7LjgIIgWOOBruW3puerrywgWOOBruWPs+errywgWeOBruS4i+errywgWeOBruS4iuerr1xyXG4gICAgdGhpcy52aWV3TWF0cml4LnNldE1heFNjcmVlblJlY3QoTEFwcERlZmluZS5WSUVXX0xPR0lDQUxfTUFYX0xFRlQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBMQXBwRGVmaW5lLlZJRVdfTE9HSUNBTF9NQVhfUklHSFQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBMQXBwRGVmaW5lLlZJRVdfTE9HSUNBTF9NQVhfQk9UVE9NLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTEFwcERlZmluZS5WSUVXX0xPR0lDQUxfTUFYX1RPUCk7IFxyXG5cclxuICAgIHRoaXMudmlld01hdHJpeC5zZXRNYXhTY2FsZShMQXBwRGVmaW5lLlZJRVdfTUFYX1NDQUxFKTtcclxuICAgIHRoaXMudmlld01hdHJpeC5zZXRNaW5TY2FsZShMQXBwRGVmaW5lLlZJRVdfTUlOX1NDQUxFKTtcclxuXHJcbiAgICB0aGlzLnByb2pNYXRyaXggPSBuZXcgTDJETWF0cml4NDQoKTtcclxuICAgIHRoaXMucHJvak1hdHJpeC5tdWx0U2NhbGUoMSwgKHdpZHRoIC8gaGVpZ2h0KSk7XHJcblxyXG4gICAgLy8g44Oe44Km44K555So44K544Kv44Oq44O844Oz5aSJ5o+b6KGM5YiXXHJcbiAgICB0aGlzLmRldmljZVRvU2NyZWVuID0gbmV3IEwyRE1hdHJpeDQ0KCk7XHJcbiAgICB0aGlzLmRldmljZVRvU2NyZWVuLm11bHRUcmFuc2xhdGUoLXdpZHRoIC8gMi4wLCAtaGVpZ2h0IC8gMi4wKTtcclxuICAgIHRoaXMuZGV2aWNlVG9TY3JlZW4ubXVsdFNjYWxlKDIgLyB3aWR0aCwgLTIgLyB3aWR0aCk7XHJcbiAgICBcclxuICAgIFxyXG4gICAgLy8gV2ViR0zjga7jgrPjg7Pjg4bjgq3jgrnjg4jjgpLlj5blvpfjgZnjgotcclxuICAgIHRoaXMuZ2wgPSBnZXRXZWJHTENvbnRleHQoKTtcclxuICAgIGlmICghdGhpcy5nbCkge1xyXG4gICAgICAgIGwyZEVycm9yKFwiRmFpbGVkIHRvIGNyZWF0ZSBXZWJHTCBjb250ZXh0LlwiKTtcclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICAvLyBPcGVuR0zjga7jgrPjg7Pjg4bjgq3jgrnjg4jjgpLjgrvjg4Pjg4hcclxuICAgIExpdmUyRC5zZXRHTCh0aGlzLmdsKTtcclxuXHJcbiAgICAvLyDmj4/nlLvjgqjjg6rjgqLjgpLnmb3jgafjgq/jg6rjgqJcclxuICAgIHRoaXMuZ2wuY2xlYXJDb2xvcigwLjAsIDAuMCwgMC4wLCAwLjApO1xyXG5cclxuICAgIGNoYW5nZU1vZGVsKCk7XHJcbiAgICBcclxuICAgIHN0YXJ0RHJhdygpO1xyXG59XHJcblxyXG5cclxuZnVuY3Rpb24gc3RhcnREcmF3KCkge1xyXG4gICAgaWYoIXRoaXMuaXNEcmF3U3RhcnQpIHtcclxuICAgICAgICB0aGlzLmlzRHJhd1N0YXJ0ID0gdHJ1ZTtcclxuICAgICAgICAoZnVuY3Rpb24gdGljaygpIHtcclxuICAgICAgICAgICAgICAgIGRyYXcoKTsgLy8gMeWbnuWIhuaPj+eUu1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciByZXF1ZXN0QW5pbWF0aW9uRnJhbWUgPSBcclxuICAgICAgICAgICAgICAgICAgICB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lIHx8IFxyXG4gICAgICAgICAgICAgICAgICAgIHdpbmRvdy5tb3pSZXF1ZXN0QW5pbWF0aW9uRnJhbWUgfHxcclxuICAgICAgICAgICAgICAgICAgICB3aW5kb3cud2Via2l0UmVxdWVzdEFuaW1hdGlvbkZyYW1lIHx8IFxyXG4gICAgICAgICAgICAgICAgICAgIHdpbmRvdy5tc1JlcXVlc3RBbmltYXRpb25GcmFtZTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyDkuIDlrprmmYLplpPlvozjgavoh6rouqvjgpLlkbzjgbPlh7rjgZlcclxuICAgICAgICAgICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZSh0aWNrICx0aGlzLmNhbnZhcyk7ICAgXHJcbiAgICAgICAgfSkoKTtcclxuICAgIH1cclxufVxyXG5cclxuXHJcbmZ1bmN0aW9uIGRyYXcoKVxyXG57XHJcbiAgICAvLyBsMmRMb2coXCItLT4gZHJhdygpXCIpO1xyXG5cclxuICAgIE1hdHJpeFN0YWNrLnJlc2V0KCk7XHJcbiAgICBNYXRyaXhTdGFjay5sb2FkSWRlbnRpdHkoKTtcclxuICAgIFxyXG4gICAgdGhpcy5kcmFnTWdyLnVwZGF0ZSgpOyAvLyDjg4njg6njg4PjgrDnlKjjg5Hjg6njg6Hjg7zjgr/jga7mm7TmlrBcclxuICAgIHRoaXMubGl2ZTJETWdyLnNldERyYWcodGhpcy5kcmFnTWdyLmdldFgoKSwgdGhpcy5kcmFnTWdyLmdldFkoKSk7XHJcbiAgICBcclxuICAgIC8vIENhbnZhc+OCkuOCr+ODquOCouOBmeOCi1xyXG4gICAgdGhpcy5nbC5jbGVhcih0aGlzLmdsLkNPTE9SX0JVRkZFUl9CSVQpO1xyXG4gICAgXHJcbiAgICBNYXRyaXhTdGFjay5tdWx0TWF0cml4KHByb2pNYXRyaXguZ2V0QXJyYXkoKSk7XHJcbiAgICBNYXRyaXhTdGFjay5tdWx0TWF0cml4KHZpZXdNYXRyaXguZ2V0QXJyYXkoKSk7XHJcbiAgICBNYXRyaXhTdGFjay5wdXNoKCk7XHJcbiAgICBcclxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5saXZlMkRNZ3IubnVtTW9kZWxzKCk7IGkrKylcclxuICAgIHtcclxuICAgICAgICB2YXIgbW9kZWwgPSB0aGlzLmxpdmUyRE1nci5nZXRNb2RlbChpKTtcclxuXHJcbiAgICAgICAgaWYobW9kZWwgPT0gbnVsbCkgcmV0dXJuO1xyXG4gICAgICAgIFxyXG4gICAgICAgIGlmIChtb2RlbC5pbml0aWFsaXplZCAmJiAhbW9kZWwudXBkYXRpbmcpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBtb2RlbC51cGRhdGUoKTtcclxuICAgICAgICAgICAgbW9kZWwuZHJhdyh0aGlzLmdsKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGlmICghdGhpcy5pc01vZGVsU2hvd24gJiYgaSA9PSB0aGlzLmxpdmUyRE1nci5udW1Nb2RlbHMoKS0xKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmlzTW9kZWxTaG93biA9ICF0aGlzLmlzTW9kZWxTaG93bjtcclxuICAgICAgICAgICAgICAgIHZhciBidG5DaGFuZ2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImJ0bkNoYW5nZVwiKTtcclxuICAgICAgICAgICAgICAgIGJ0bkNoYW5nZS50ZXh0Q29udGVudCA9IFwiQ2hhbmdlIE1vZGVsXCI7XHJcbiAgICAgICAgICAgICAgICBidG5DaGFuZ2UucmVtb3ZlQXR0cmlidXRlKFwiZGlzYWJsZWRcIik7XHJcbiAgICAgICAgICAgICAgICBidG5DaGFuZ2Uuc2V0QXR0cmlidXRlKFwiY2xhc3NcIiwgXCJhY3RpdmVcIik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBcclxuICAgIE1hdHJpeFN0YWNrLnBvcCgpO1xyXG59XHJcblxyXG5cclxuZnVuY3Rpb24gY2hhbmdlTW9kZWwoKVxyXG57XHJcbiAgICB2YXIgYnRuQ2hhbmdlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJidG5DaGFuZ2VcIik7XHJcbiAgICBidG5DaGFuZ2Uuc2V0QXR0cmlidXRlKFwiZGlzYWJsZWRcIixcImRpc2FibGVkXCIpO1xyXG4gICAgYnRuQ2hhbmdlLnNldEF0dHJpYnV0ZShcImNsYXNzXCIsIFwiaW5hY3RpdmVcIik7XHJcbiAgICBidG5DaGFuZ2UudGV4dENvbnRlbnQgPSBcIk5vdyBMb2FkaW5nLi4uXCI7XHJcbiAgICB0aGlzLmlzTW9kZWxTaG93biA9IGZhbHNlO1xyXG4gICAgXHJcbiAgICB0aGlzLmxpdmUyRE1nci5yZWxvYWRGbGcgPSB0cnVlO1xyXG4gICAgdGhpcy5saXZlMkRNZ3IuY291bnQrKztcclxuXHJcbiAgICB0aGlzLmxpdmUyRE1nci5jaGFuZ2VNb2RlbCh0aGlzLmdsKTtcclxufVxyXG5cclxuLyogKioqKioqKioqKiDjg57jgqbjgrnjgqTjg5njg7Pjg4ggKioqKioqKioqKiAqL1xyXG5cclxuLypcclxuICog44Oe44Km44K544Ob44Kk44O844Or44Gr44KI44KL5ouh5aSn57iu5bCPXHJcbiAqL1xyXG5mdW5jdGlvbiBtb2RlbFNjYWxpbmcoc2NhbGUpXHJcbnsgICBcclxuICAgIHZhciBpc01heFNjYWxlID0gdGhpc1JlZi52aWV3TWF0cml4LmlzTWF4U2NhbGUoKTtcclxuICAgIHZhciBpc01pblNjYWxlID0gdGhpc1JlZi52aWV3TWF0cml4LmlzTWluU2NhbGUoKTtcclxuICAgIFxyXG4gICAgdGhpc1JlZi52aWV3TWF0cml4LmFkanVzdFNjYWxlKDAsIDAsIHNjYWxlKTtcclxuXHJcbiAgICAvLyDnlLvpnaLjgYzmnIDlpKfjgavjgarjgaPjgZ/jgajjgY3jga7jgqTjg5njg7Pjg4hcclxuICAgIGlmICghaXNNYXhTY2FsZSlcclxuICAgIHtcclxuICAgICAgICBpZiAodGhpc1JlZi52aWV3TWF0cml4LmlzTWF4U2NhbGUoKSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHRoaXNSZWYubGl2ZTJETWdyLm1heFNjYWxlRXZlbnQoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICAvLyDnlLvpnaLjgYzmnIDlsI/jgavjgarjgaPjgZ/jgajjgY3jga7jgqTjg5njg7Pjg4hcclxuICAgIGlmICghaXNNaW5TY2FsZSlcclxuICAgIHtcclxuICAgICAgICBpZiAodGhpc1JlZi52aWV3TWF0cml4LmlzTWluU2NhbGUoKSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHRoaXNSZWYubGl2ZTJETWdyLm1pblNjYWxlRXZlbnQoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuXHJcblxyXG4vKlxyXG4gKiDjgq/jg6rjg4Pjgq/jgZXjgozjgZ/mlrnlkJHjgpLlkJHjgY9cclxuICog44K/44OD44OX44GV44KM44Gf5aC05omA44Gr5b+c44GY44Gm44Oi44O844K344On44Oz44KS5YaN55SfXHJcbiAqL1xyXG5mdW5jdGlvbiBtb2RlbFR1cm5IZWFkKGV2ZW50KVxyXG57XHJcbiAgICB0aGlzUmVmLmRyYWcgPSB0cnVlO1xyXG4gICAgXHJcbiAgICB2YXIgcmVjdCA9IGV2ZW50LnRhcmdldC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcclxuICAgIFxyXG4gICAgdmFyIHN4ID0gdHJhbnNmb3JtU2NyZWVuWChldmVudC5jbGllbnRYIC0gcmVjdC5sZWZ0KTtcclxuICAgIHZhciBzeSA9IHRyYW5zZm9ybVNjcmVlblkoZXZlbnQuY2xpZW50WSAtIHJlY3QudG9wKTtcclxuICAgIHZhciB2eCA9IHRyYW5zZm9ybVZpZXdYKGV2ZW50LmNsaWVudFggLSByZWN0LmxlZnQpO1xyXG4gICAgdmFyIHZ5ID0gdHJhbnNmb3JtVmlld1koZXZlbnQuY2xpZW50WSAtIHJlY3QudG9wKTtcclxuICAgIFxyXG4gICAgaWYgKExBcHBEZWZpbmUuREVCVUdfTU9VU0VfTE9HKVxyXG4gICAgICAgIGwyZExvZyhcIm9uTW91c2VEb3duIGRldmljZSggeDpcIiArIGV2ZW50LmNsaWVudFggKyBcIiB5OlwiICsgZXZlbnQuY2xpZW50WSArIFwiICkgdmlldyggeDpcIiArIHZ4ICsgXCIgeTpcIiArIHZ5ICsgXCIpXCIpO1xyXG5cclxuICAgIHRoaXNSZWYubGFzdE1vdXNlWCA9IHN4O1xyXG4gICAgdGhpc1JlZi5sYXN0TW91c2VZID0gc3k7XHJcblxyXG4gICAgdGhpc1JlZi5kcmFnTWdyLnNldFBvaW50KHZ4LCB2eSk7IC8vIOOBneOBruaWueWQkeOCkuWQkeOBj1xyXG4gICAgXHJcbiAgICAvLyDjgr/jg4Pjg5fjgZfjgZ/loLTmiYDjgavlv5zjgZjjgabjg6Ljg7zjgrfjg6fjg7PjgpLlho3nlJ9cclxuICAgIHRoaXNSZWYubGl2ZTJETWdyLnRhcEV2ZW50KHZ4LCB2eSk7XHJcbn1cclxuXHJcblxyXG4vKlxyXG4gKiDjg57jgqbjgrnjgpLli5XjgYvjgZfjgZ/mmYLjga7jgqTjg5njg7Pjg4hcclxuICovXHJcbmZ1bmN0aW9uIGZvbGxvd1BvaW50ZXIoZXZlbnQpXHJcbnsgICAgXHJcbiAgICB2YXIgcmVjdCA9IGV2ZW50LnRhcmdldC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcclxuICAgIFxyXG4gICAgdmFyIHN4ID0gdHJhbnNmb3JtU2NyZWVuWChldmVudC5jbGllbnRYIC0gcmVjdC5sZWZ0KTtcclxuICAgIHZhciBzeSA9IHRyYW5zZm9ybVNjcmVlblkoZXZlbnQuY2xpZW50WSAtIHJlY3QudG9wKTtcclxuICAgIHZhciB2eCA9IHRyYW5zZm9ybVZpZXdYKGV2ZW50LmNsaWVudFggLSByZWN0LmxlZnQpO1xyXG4gICAgdmFyIHZ5ID0gdHJhbnNmb3JtVmlld1koZXZlbnQuY2xpZW50WSAtIHJlY3QudG9wKTtcclxuICAgIFxyXG4gICAgaWYgKExBcHBEZWZpbmUuREVCVUdfTU9VU0VfTE9HKVxyXG4gICAgICAgIGwyZExvZyhcIm9uTW91c2VNb3ZlIGRldmljZSggeDpcIiArIGV2ZW50LmNsaWVudFggKyBcIiB5OlwiICsgZXZlbnQuY2xpZW50WSArIFwiICkgdmlldyggeDpcIiArIHZ4ICsgXCIgeTpcIiArIHZ5ICsgXCIpXCIpO1xyXG5cclxuICAgIGlmICh0aGlzUmVmLmRyYWcpXHJcbiAgICB7XHJcbiAgICAgICAgdGhpc1JlZi5sYXN0TW91c2VYID0gc3g7XHJcbiAgICAgICAgdGhpc1JlZi5sYXN0TW91c2VZID0gc3k7XHJcblxyXG4gICAgICAgIHRoaXNSZWYuZHJhZ01nci5zZXRQb2ludCh2eCwgdnkpOyAvLyDjgZ3jga7mlrnlkJHjgpLlkJHjgY9cclxuICAgIH1cclxufVxyXG5cclxuXHJcbi8qXHJcbiAqIOato+mdouOCkuWQkeOBj1xyXG4gKi9cclxuZnVuY3Rpb24gbG9va0Zyb250KClcclxueyAgIFxyXG4gICAgaWYgKHRoaXNSZWYuZHJhZylcclxuICAgIHtcclxuICAgICAgICB0aGlzUmVmLmRyYWcgPSBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzUmVmLmRyYWdNZ3Iuc2V0UG9pbnQoMCwgMCk7XHJcbn1cclxuXHJcblxyXG5mdW5jdGlvbiBtb3VzZUV2ZW50KGUpXHJcbntcclxuICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgIFxyXG4gICAgaWYgKGUudHlwZSA9PSBcIm1vdXNld2hlZWxcIikge1xyXG5cclxuICAgICAgICBpZiAoZS5jbGllbnRYIDwgMCB8fCB0aGlzUmVmLmNhbnZhcy5jbGllbnRXaWR0aCA8IGUuY2xpZW50WCB8fCBcclxuICAgICAgICBlLmNsaWVudFkgPCAwIHx8IHRoaXNSZWYuY2FudmFzLmNsaWVudEhlaWdodCA8IGUuY2xpZW50WSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgaWYgKGUud2hlZWxEZWx0YSA+IDApIG1vZGVsU2NhbGluZygxLjEpOyAvLyDkuIrmlrnlkJHjgrnjgq/jg63jg7zjg6sg5ouh5aSnXHJcbiAgICAgICAgZWxzZSBtb2RlbFNjYWxpbmcoMC45KTsgLy8g5LiL5pa55ZCR44K544Kv44Ot44O844OrIOe4ruWwj1xyXG5cclxuICAgICAgICBcclxuICAgIH0gZWxzZSBpZiAoZS50eXBlID09IFwibW91c2Vkb3duXCIpIHtcclxuXHJcbiAgICAgICAgLy8g5Y+z44Kv44Oq44OD44Kv5Lul5aSW44Gq44KJ5Yem55CG44KS5oqc44GR44KLXHJcbiAgICAgICAgaWYoXCJidXR0b25cIiBpbiBlICYmIGUuYnV0dG9uICE9IDApIHJldHVybjtcclxuICAgICAgICBcclxuICAgICAgICBtb2RlbFR1cm5IZWFkKGUpO1xyXG4gICAgICAgIFxyXG4gICAgfSBlbHNlIGlmIChlLnR5cGUgPT0gXCJtb3VzZW1vdmVcIikge1xyXG4gICAgICAgIFxyXG4gICAgICAgIGZvbGxvd1BvaW50ZXIoZSk7XHJcbiAgICAgICAgXHJcbiAgICB9IGVsc2UgaWYgKGUudHlwZSA9PSBcIm1vdXNldXBcIikge1xyXG4gICAgICAgIFxyXG4gICAgICAgIC8vIOWPs+OCr+ODquODg+OCr+S7peWkluOBquOCieWHpueQhuOCkuaKnOOBkeOCi1xyXG4gICAgICAgIGlmKFwiYnV0dG9uXCIgaW4gZSAmJiBlLmJ1dHRvbiAhPSAwKSByZXR1cm47XHJcbiAgICAgICAgXHJcbiAgICAgICAgbG9va0Zyb250KCk7XHJcbiAgICAgICAgXHJcbiAgICB9IGVsc2UgaWYgKGUudHlwZSA9PSBcIm1vdXNlb3V0XCIpIHtcclxuICAgICAgICBcclxuICAgICAgICBsb29rRnJvbnQoKTtcclxuICAgICAgICBcclxuICAgIH0gZWxzZSBpZiAoZS50eXBlID09IFwiY29udGV4dG1lbnVcIikge1xyXG4gICAgICAgIFxyXG4gICAgICAgIGNoYW5nZU1vZGVsKCk7XHJcbiAgICB9XHJcblxyXG59XHJcblxyXG5cclxuZnVuY3Rpb24gdG91Y2hFdmVudChlKVxyXG57XHJcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICBcclxuICAgIHZhciB0b3VjaCA9IGUudG91Y2hlc1swXTtcclxuICAgIFxyXG4gICAgaWYgKGUudHlwZSA9PSBcInRvdWNoc3RhcnRcIikge1xyXG4gICAgICAgIGlmIChlLnRvdWNoZXMubGVuZ3RoID09IDEpIG1vZGVsVHVybkhlYWQodG91Y2gpO1xyXG4gICAgICAgIC8vIG9uQ2xpY2sodG91Y2gpO1xyXG4gICAgICAgIFxyXG4gICAgfSBlbHNlIGlmIChlLnR5cGUgPT0gXCJ0b3VjaG1vdmVcIikge1xyXG4gICAgICAgIGZvbGxvd1BvaW50ZXIodG91Y2gpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIGlmIChlLnRvdWNoZXMubGVuZ3RoID09IDIpIHtcclxuICAgICAgICAgICAgdmFyIHRvdWNoMSA9IGUudG91Y2hlc1swXTtcclxuICAgICAgICAgICAgdmFyIHRvdWNoMiA9IGUudG91Y2hlc1sxXTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIHZhciBsZW4gPSBNYXRoLnBvdyh0b3VjaDEucGFnZVggLSB0b3VjaDIucGFnZVgsIDIpICsgTWF0aC5wb3codG91Y2gxLnBhZ2VZIC0gdG91Y2gyLnBhZ2VZLCAyKTtcclxuICAgICAgICAgICAgaWYgKHRoaXNSZWYub2xkTGVuIC0gbGVuIDwgMCkgbW9kZWxTY2FsaW5nKDEuMDI1KTsgLy8g5LiK5pa55ZCR44K544Kv44Ot44O844OrIOaLoeWkp1xyXG4gICAgICAgICAgICBlbHNlIG1vZGVsU2NhbGluZygwLjk3NSk7IC8vIOS4i+aWueWQkeOCueOCr+ODreODvOODqyDnuK7lsI9cclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIHRoaXNSZWYub2xkTGVuID0gbGVuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgIH0gZWxzZSBpZiAoZS50eXBlID09IFwidG91Y2hlbmRcIikge1xyXG4gICAgICAgIGxvb2tGcm9udCgpO1xyXG4gICAgfVxyXG59XHJcblxyXG5cclxuLyogKioqKioqKioqKiDjg57jg4jjg6rjg4Pjgq/jgrnmk43kvZwgKioqKioqKioqKiAqL1xyXG5cclxuZnVuY3Rpb24gdHJhbnNmb3JtVmlld1goZGV2aWNlWClcclxue1xyXG4gICAgdmFyIHNjcmVlblggPSB0aGlzLmRldmljZVRvU2NyZWVuLnRyYW5zZm9ybVgoZGV2aWNlWCk7IC8vIOirlueQhuW6p+aomeWkieaPm+OBl+OBn+W6p+aomeOCkuWPluW+l+OAglxyXG4gICAgcmV0dXJuIHZpZXdNYXRyaXguaW52ZXJ0VHJhbnNmb3JtWChzY3JlZW5YKTsgLy8g5ouh5aSn44CB57iu5bCP44CB56e75YuV5b6M44Gu5YCk44CCXHJcbn1cclxuXHJcblxyXG5mdW5jdGlvbiB0cmFuc2Zvcm1WaWV3WShkZXZpY2VZKVxyXG57XHJcbiAgICB2YXIgc2NyZWVuWSA9IHRoaXMuZGV2aWNlVG9TY3JlZW4udHJhbnNmb3JtWShkZXZpY2VZKTsgLy8g6KuW55CG5bqn5qiZ5aSJ5o+b44GX44Gf5bqn5qiZ44KS5Y+W5b6X44CCXHJcbiAgICByZXR1cm4gdmlld01hdHJpeC5pbnZlcnRUcmFuc2Zvcm1ZKHNjcmVlblkpOyAvLyDmi6HlpKfjgIHnuK7lsI/jgIHnp7vli5Xlvozjga7lgKTjgIJcclxufVxyXG5cclxuXHJcbmZ1bmN0aW9uIHRyYW5zZm9ybVNjcmVlblgoZGV2aWNlWClcclxue1xyXG4gICAgcmV0dXJuIHRoaXMuZGV2aWNlVG9TY3JlZW4udHJhbnNmb3JtWChkZXZpY2VYKTtcclxufVxyXG5cclxuXHJcbmZ1bmN0aW9uIHRyYW5zZm9ybVNjcmVlblkoZGV2aWNlWSlcclxue1xyXG4gICAgcmV0dXJuIHRoaXMuZGV2aWNlVG9TY3JlZW4udHJhbnNmb3JtWShkZXZpY2VZKTtcclxufVxyXG5cclxuXHJcbi8qXHJcbiogV2ViR0zjga7jgrPjg7Pjg4bjgq3jgrnjg4jjgpLlj5blvpfjgZnjgotcclxuKi9cclxuZnVuY3Rpb24gZ2V0V2ViR0xDb250ZXh0KClcclxue1xyXG4gICAgdmFyIE5BTUVTID0gWyBcIndlYmdsXCIgLCBcImV4cGVyaW1lbnRhbC13ZWJnbFwiICwgXCJ3ZWJraXQtM2RcIiAsIFwibW96LXdlYmdsXCJdO1xyXG5cclxuICAgIGZvciggdmFyIGkgPSAwOyBpIDwgTkFNRVMubGVuZ3RoOyBpKysgKXtcclxuICAgICAgICB0cnl7XHJcbiAgICAgICAgICAgIHZhciBjdHggPSB0aGlzLmNhbnZhcy5nZXRDb250ZXh0KE5BTUVTW2ldLCB7cHJlbXVsdGlwbGllZEFscGhhIDogdHJ1ZX0pO1xyXG4gICAgICAgICAgICBpZihjdHgpIHJldHVybiBjdHg7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNhdGNoKGUpe31cclxuICAgIH1cclxuICAgIHJldHVybiBudWxsO1xyXG59O1xyXG5cclxuXHJcbi8qXHJcbiog55S76Z2i44Ot44Kw44KS5Ye65YqbXHJcbiovXHJcbmZ1bmN0aW9uIGwyZExvZyhtc2cpIHtcclxuICAgIGlmKCFMQXBwRGVmaW5lLkRFQlVHX0xPRykgcmV0dXJuO1xyXG4gICAgXHJcbiAgICB2YXIgbXljb25zb2xlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJteWNvbnNvbGVcIik7XHJcbiAgICBteWNvbnNvbGUuaW5uZXJIVE1MID0gbXljb25zb2xlLmlubmVySFRNTCArIFwiPGJyPlwiICsgbXNnO1xyXG4gICAgXHJcbiAgICBjb25zb2xlLmxvZyhtc2cpO1xyXG59XHJcblxyXG5cclxuLypcclxuKiDnlLvpnaLjgqjjg6njg7zjgpLlh7rliptcclxuKi9cclxuZnVuY3Rpb24gbDJkRXJyb3IobXNnKVxyXG57XHJcbiAgICBpZighTEFwcERlZmluZS5ERUJVR19MT0cpIHJldHVybjtcclxuICAgIFxyXG4gICAgbDJkTG9nKCBcIjxzcGFuIHN0eWxlPSdjb2xvcjpyZWQnPlwiICsgbXNnICsgXCI8L3NwYW4+XCIpO1xyXG4gICAgXHJcbiAgICBjb25zb2xlLmVycm9yKG1zZyk7XHJcbn07Il19
